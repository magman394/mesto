!function(){"use strict";class e{constructor(e,t,s,r,i,n,o,a,l,c,_){this._title=e,this._link=t,this._likes=s,this._cardSelector=n,this._handleCardClick=o,this._cardid=i,this._id=r,this._api=l,this._popupopen=a,this._arrLikes=c,this._myid=_._myid}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector("#cardElement").cloneNode(!0)}_setEventListeners(){this._imageCard.addEventListener("click",(()=>{this._handleCardClick()})),this._cardLike.addEventListener("click",(()=>{this._arrLikes.forEach((e=>{this._arrLikeID=e._id})),this._botton=this._element.querySelector("#likebutton"),this._botton.classList.contains("element__likes_active")?this._api.dellikeCard(this._cardid).then((()=>{this._dellike()})).catch((e=>alert(e))):this._api.likeCard(this._cardid).then((()=>{this._addlike()})).catch((e=>alert(e)))})),this._cardDel.addEventListener("click",(()=>{this.delCardClick()}))}_mylike(){this._arrLikes.forEach((e=>{e._id===this._myid?this._cardLike.classList.add("element__likes_active"):this._cardLike.classList.remove("element__likes_active")}))}_dellike(){this._cardLike.classList.toggle("element__likes_active"),this._allLikes.textContent=this._likes.length-=1}_addlike(){this._cardLike.classList.toggle("element__likes_active"),this._allLikes.textContent=this._likes.length+=1}_whatiscard(){this._cardDel=this._element.querySelector(".element__btn_delete"),this._bottonDel=this._cardDel.querySelector("#bottonDel"),this._id===this._myid?(this._cardDel.classList.remove("element__btn"),this._cardDel.classList.add("element__btn_delete"),this._bottonDel.classList.add("element__btn_delete-active")):(this._cardDel.classList.remove("element__btn_delete"),this._bottonDel.classList.add("element__btn_delete-active"))}delCardClick(){this._popupopen.open((()=>{this._api.delmyCard(this._cardid).then((()=>{this._element.remove(),this._popupopen.close()})).catch((e=>alert(e)))}))}generateCard(){return this._element=this._getTemplate(),this._imageCard=this._element.querySelector("#cardLink"),this._imageTitle=this._element.querySelector("#cardTitle"),this._cardLike=this._element.querySelector(".element__likes_like-btn"),this._mylike(),this._whatiscard(),this._setEventListeners(),this._allLikes=this._element.querySelector(".element__likes_like-count"),this._imageTitle.textContent=this._title,this._allLikes.textContent=this._likes.length,this._imageCard.alt=this._title,this._imageCard.src=this._link,this._element}}document.querySelector(".popup__close_image"),document.querySelector(".popup__image"),document.querySelector("#popupTtl");const t=document.querySelector("#saveAutor"),s=document.querySelector("#saveCard"),r=document.querySelector("#saveAvatar"),i=(document.querySelector("#formCards"),document.querySelector(".popup__close"),document.querySelector("form"),document.querySelector(".popup__close"),document.querySelector(".popup_is-opened"),document.querySelectorAll(".popup__submit"),document.querySelector(".profile__avatar")),n=(document.querySelector("#firstName"),document.querySelector("#lastName"),document.querySelector(".popup__container"),document.querySelector("#formAutor")),o=document.querySelector("#formCards"),a=document.querySelector("#formAvatar"),l=document.querySelector("#formDel"),c=document.querySelector(".profile__edit-botton"),_=document.querySelector(".profile__add-botton"),h=(document.querySelector("#save"),document.querySelector(".element__btn"),{inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_invalid",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_visible"});class d{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._validElement=t}_allInputEmpty(){return!this._inputList.some((e=>e.value.length>0))}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_showInputError(e){this.errorElement=this._validElement.querySelector("#".concat(e.id,"-error")),e.classList.add(this._inputErrorClass),this.errorElement.textContent=e.validationMessage,this.errorElement.classList.add(this._errorClass)}_hideInputError(e){this.errorElement=this._validElement.querySelector("#".concat(e.id,"-error")),e.classList.remove(this._inputErrorClass),this.errorElement.classList.remove(this._errorClass)}_checkInput(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}removeFormErrorContainer(){this._validElement.querySelectorAll(".popup__error").forEach((e=>{e.classList.remove(this._errorClass)})),this._validElement.querySelectorAll(this._inputSelector).forEach((e=>{e.classList.remove(this._inputErrorClass)}))}_toggleButtonState(){this._hasInvalidInput(this._inputList)||this._allInputEmpty(this._inputList)?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0)):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.removeAttribute("disabled"))}_setInputListeners(){this._inputList=Array.from(this._validElement.querySelectorAll(this._inputSelector)),this._buttonElement=this._validElement.querySelector(this._submitButtonSelector),this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInput(e),this._toggleButtonState()}))}))}enableValidation(){this._validElement.addEventListener("submit",(e=>{e.preventDefault(),this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0)})),this._setInputListeners()}}class u{constructor(e){var t,s;s=e=>{"Escape"!==e.key&&e.target!==this._section||this.close()},(t="_handleEscClose")in this?Object.defineProperty(this,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[t]=s,this._section=document.querySelector(e)}open(){this._section.classList.add("popup_is-opened"),document.addEventListener("keydown",this._handleEscClose),this._section.addEventListener("mousedown",this._handleEscClose)}close(){this._section.classList.remove("popup_is-opened"),document.removeEventListener("keydown",this._handleEscClose),document.removeEventListener("mousedown",this._handleEscClose)}setEventListeners(){this._section.querySelector(".popup__close").addEventListener("click",(()=>{this.close()}))}}class m extends u{constructor(e,t){super(e),this._formSubmit=t,this._popupForm=this._section.querySelector(".popup__container"),this._form=this._section.querySelector("form")}_getImputValues(){return this._cardValues={},this._popupForm.querySelectorAll(".popup__input").forEach((e=>{this._cardValues[e.name]=e.value,this._cardValues.avatar=e.value})),this._cardValues}setEventListeners(){super.setEventListeners(),this._section.addEventListener("submit",(e=>{e.preventDefault(),this._formSubmit(this._getImputValues())}))}close(){this._form.reset(),super.close()}}const p=new d(h,n);p.removeFormErrorContainer(),p.enableValidation();const v=new d(h,o);v.removeFormErrorContainer(),v.enableValidation();const E=new d(h,a);function y(t){return new e(t.name,t.link,t.likes,t.owner._id,t._id,"#boxCards",(()=>{k.open(t)}),b,C,t.likes,S).generateCard(t)}E.removeFormErrorContainer(),E.enableValidation();const C=new class{constructor(e){this._url=e.url,this._headers=e.headers}_getResponseData(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}getAllTasks(){return fetch(this._url+"cards",{method:"GET",headers:this._headers}).then((e=>this._getResponseData(e)))}getUserInfo(){return fetch(this._url+"users/me",{method:"GET",headers:this._headers}).then((e=>this._getResponseData(e)))}getAllPromise(){return Promise.all([this.getUserInfo(),this.getAllTasks()])}addTask(e){return fetch(this._url+"cards",{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})}).then((e=>this._getResponseData(e)))}delmyCard(e){return fetch("".concat(this._url+"cards/").concat(e),{method:"DELETE",headers:this._headers}).then((e=>this._getResponseData(e)))}likeCard(e){return fetch("".concat(this._url+"cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then((e=>this._getResponseData(e)))}dellikeCard(e){return fetch("".concat(this._url+"cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then((e=>this._getResponseData(e)))}patchUserInfo(e,t){return fetch(this._url+"users/me",{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then((e=>this._getResponseData(e)))}patchUserAvatar(e){return fetch(this._url+"users/me/avatar",{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((e=>this._getResponseData(e)))}}({url:"https://mesto.nomoreparties.co/v1/cohort-24/",headers:{authorization:"b94e78d1-b2d6-4481-aa74-fc7e4dc8c239","Content-Type":"application/json"}});C.getAllPromise().then((e=>{const[t,s]=e;S.setUserInfo(t.name,t.about,t.avatar,t._id),f.renderItems(s)})).catch((e=>alert(e)));const f=new class{constructor(e,t){let{renderer:s,containerSelector:r}=e;this._renderer=s,this._section=document.querySelector(r),this._api=t}setItem(e){this._section.append(e)}setItemNewCard(e){this._section.prepend(e)}renderItems(e){e.forEach((e=>{this.setItem(this._renderer(e))}))}}({renderer:e=>y({name:e.name,link:e.link,likes:e.likes,owner:{_id:e.owner._id},_id:e._id}),containerSelector:".elements"}),k=new class extends u{constructor(e){super(e)}open(e){let{name:t,link:s}=e;const r=this._section.querySelector(".popup__image"),i=this._section.querySelector(".popup__title");r.src=s,r.alt=t,i.textContent=t,super.open()}}("#popupImage");k.setEventListeners();const S=new class{constructor(e,t,s){this._firstName=document.querySelector(e),this._lastName=document.querySelector(t),this._avatar=document.querySelector(s)}setUserInfo(e,t,s,r){this._firstName.textContent=e,this._lastName.textContent=t,this._avatar.src=s,this._myid=r}addUserInfo(e,t){this._firstName.textContent=e,this._lastName.textContent=t}getUserInfo(){return this._userInfo={},this._userInfo.firstName=this._firstName.textContent,this._userInfo.lastName=this._lastName.textContent,this._userInfo}getUserAvatar(e){return this._avatar.src=e,this._userInfo}}(".profile__name",".profile__profession",".profile__avatar"),L=new m("#popupAutor",(e=>{const s={firstName:e.firstName,lastName:e.lastName};I(t,!0),C.patchUserInfo(s.firstName,s.lastName).then((()=>{S.addUserInfo(s.firstName,s.lastName),L.close()})).catch((e=>{"Ошибка: ".concat(e.status)})).finally((()=>{I(t,!1)}))}));L.setEventListeners(),_.addEventListener("click",(()=>{v.removeFormErrorContainer(),g.open()})),c.addEventListener("click",(()=>{p.removeFormErrorContainer();const e=S.getUserInfo();firstName.value=e.firstName,lastName.value=e.lastName,p.removeFormErrorContainer(),L.open()}));const b=new class extends u{constructor(e,t,s){super(e),this._delSubmit=t,this._api=s}open(e){super.open(),this._actionFn=e,document.querySelector("#deleteCard").textContent="Да"}setEventListeners(){super.setEventListeners(),this._delSubmit.addEventListener("submit",(e=>{e.preventDefault(),this._actionFn()}))}}("#popupDelCard",l,C);b.setEventListeners();const g=new m("#popupCard",(e=>{const t={name:e.name,link:e.link,id:e.cardid};I(s,!0),C.addTask(t).then((e=>{const t=y(e);f.setItemNewCard(t),g.close()})).catch((e=>{"Ошибка: ".concat(e.status)})).finally((()=>{I(s,!1)}))}));g.setEventListeners();const q=new m("#popupAvatar",(e=>{const t=e.avatar;I(r,!0),C.patchUserAvatar(t).then((e=>{S.getUserAvatar(e.avatar),q.close()})).catch((e=>{"Ошибка: ".concat(e.status)})).finally((()=>{I(r,!1)}))}));function I(e,t){e.textContent="Сохранение...",t||(e.textContent="Сохранить")}i.addEventListener("click",(()=>{q.open()})),q.setEventListeners()}();